#!/usr/bin/env bash

## Introduction:  ortho-rectified

dir=/BhaltosMount/Bhaltos/GREENLAND/2021_NNA_PROJECT/PERMAFROST/ITTOQQOTROORMIIT
dem=${dir}/PRODUCTS/WV03_20200823_104001005E502500_104001005E7F9400/strips/WV03_20200823_104001005E502500_104001005E7F9400_2m_lsf_seg1_dem.tif

prj=$(gdalsrsinfo -o epsg ${dem})

ntf1=${dir}/DATA/WV03_20200823_104001005E502500_104001005E7F9400/WV03_20200823131523_104001005E7F9400_20AUG23131523-P1BS-013752542010_01_P001.ntf
ntf2=${dir}/DATA/WV03_20200823_104001005E502500_104001005E7F9400/WV03_20200823131524_104001005E7F9400_20AUG23131524-P1BS-013752542010_01_P002.ntf
ntf3=${dir}/DATA/WV03_20200823_104001005E502500_104001005E7F9400/WV03_20200823131615_104001005E502500_20AUG23131615-P1BS-013752519010_01_P001.ntf
ntf4=${dir}/DATA/WV03_20200823_104001005E502500_104001005E7F9400/WV03_20200823131616_104001005E502500_20AUG23131616-P1BS-013752519010_01_P002.ntf

res=0.5
function warp(){
    img=$1
    out=$(basename $img).tif
    echo $img
    echo $out

# -rpc
    gdalwarp -co compress=lzw -co tiled=yes -co bigtiff=if_safer -tr ${res} ${res} -t_srs ${prj} \
          -multi -wo NUM_THREADS=8  -r cubic -et 0.01 -to "RPC_DEM=${dem}" ${img}  ${out}
}


warp $ntf1
warp $ntf2
warp $ntf3
warp $ntf4